clc; clearvars;

lat_bounds = [40.5 40.95];
lon_bounds = [-74.26 -73.6];

tempo_path = "C:\Users\tely1\OneDrive - The City College of New York\NERTO Data\TEMPO_data";
tempo_file = "\TEMPO_NO2_L2_V03_20240525T161528Z_S008G03.nc";
tempo_fullpath = fullfile(tempo_path, tempo_file);

tropomi_path = "C:\Users\tely1\OneDrive - The City College of New York\NERTO Data\TROPOMI_data";
tropomi_file = "\S5P_OFFL_L2__NO2____20240525T160624_20240525T174754_34281_03_020600_20240527T081504.nc";
tropomi_fullpath = fullfile(tropomi_path, tropomi_file);

tempo_lat = ncread(tempo_fullpath, '/geolocation/latitude');
tempo_lon = ncread(tempo_fullpath, '/geolocation/longitude');
tempo_lat_corners = ncread(tempo_fullpath, '/geolocation/latitude_bounds');
tempo_lon_corners = ncread(tempo_fullpath, '/geolocation/longitude_bounds');

tempo_ind = tempo_lat>=lat_bounds(1) & tempo_lat<=lat_bounds(2) & tempo_lon>=lon_bounds(1) & tempo_lon<=lon_bounds(2);
[tempo_row, tempo_col] = ind2sub(size(tempo_lat), find(tempo_ind));
tempo_lat = tempo_lat(tempo_ind);
tempo_lon = tempo_lon(tempo_ind);
tempo_lat_corners = tempo_lat_corners(:,tempo_row,tempo_col);
tempo_lon_corners = tempo_lon_corners(:,tempo_row,tempo_col);

trop_lat = ncread(tropomi_fullpath, '/PRODUCT/latitude');
trop_lon = ncread(tropomi_fullpath, '/PRODUCT/longitude');
trop_lat_corners = ncread(tropomi_fullpath, '/PRODUCT/SUPPORT_DATA/GEOLOCATIONS/latitude_bounds');
trop_lon_corners = ncread(tropomi_fullpath, '/PRODUCT/SUPPORT_DATA/GEOLOCATIONS/longitude_bounds');

trop_ind = trop_lat>=lat_bounds(1) & trop_lat<=lat_bounds(2) & trop_lon>=lon_bounds(1) & trop_lon<=lon_bounds(2);
[trop_row, trop_col] = ind2sub(size(trop_lat), find(trop_ind));
trop_lat = trop_lat(trop_ind);
trop_lon = trop_lon(trop_ind);
trop_lat_corners = trop_lat_corners(:,trop_row,trop_col);
trop_lon_corners = trop_lon_corners(:,trop_row,trop_col);



tiledlayout(1,2)
nexttile

surfacem(tempotempo_lat, tempo_lon)